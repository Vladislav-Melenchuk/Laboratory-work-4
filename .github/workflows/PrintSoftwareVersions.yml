name: Print Software Versions

on:
  push:
    branches: [main]

jobs:
  PrintLanguageVersions:
    runs-on: ubuntu-22.04
    steps:
      - name: Print Node Version
        run: node --version

  PrintDBMSVersions:
    runs-on: ubuntu-22.04
    needs: PrintLanguageVersions
    steps:
      - name: Install prerequisites
        run: |
          sudo apt-get update
          sudo apt-get install -y wget unzip libaio1

      - name: Download Oracle Instant Client (basiclite + sqlplus)
        run: |
          mkdir -p "$HOME/oracle"
          cd "$HOME/oracle"

          wget -q https://download.oracle.com/otn_software/linux/instantclient/instantclient-basiclite-linuxx64.zip -O basiclite.zip
          wget -q https://download.oracle.com/otn_software/linux/instantclient/instantclient-sqlplus-linuxx64.zip -O sqlplus.zip

          unzip -q basiclite.zip
          unzip -q sqlplus.zip

          IC_DIR="$(find "$HOME/oracle" -maxdepth 1 -type d -name 'instantclient_*' | head -n 1)"
          echo "IC_DIR=$IC_DIR" >> $GITHUB_ENV

          echo "$IC_DIR" >> $GITHUB_PATH
          echo "LD_LIBRARY_PATH=$IC_DIR" >> $GITHUB_ENV

      - name: Print Oracle SQL*Plus Version
        run: |
          echo "Using Instant Client at: $IC_DIR"
          "$IC_DIR/sqlplus" -V
